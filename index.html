<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºæ…§å¥åº· Phase 2 (RWD Dual Mode)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Noto Sans TC', 'sans-serif'] },
                    colors: {
                        mvp: {
                            main: '#00b09b',
                            light: '#e0f7fa',
                            gradStart: '#00b09b',
                            gradEnd: '#96c93d'
                        },
                        femh: {
                            100: '#e0f7fa',
                            500: '#00b09b',
                            600: '#008ba3'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(100%)' }, '100%': { transform: 'translateY(0)' } },
                    }
                }
            }
        }
    </script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- æ ¸å¿ƒç­–ç•¥ï¼šé›™æ¨¡å¼åˆ‡æ› (Dual Mode) --- */

        /* 1. é è¨­ï¼šæ‰‹æ©Ÿç‰ˆå„ªå…ˆ (Mobile First) */
        body {
            background-color: #fff; /* æ‰‹æ©Ÿä¸Šä¸éœ€è¦æ·±è‰²èƒŒæ™¯ */
            margin: 0;
            height: 100vh;
            overflow: hidden; /* é˜²æ­¢ body æ²å‹• */
        }

        .iphone-frame {
            width: 100%;       /* å¯¬åº¦æ’æ»¿ */
            height: 100%;      /* é«˜åº¦æ’æ»¿ */
            border: none;      /* ä¸è¦é‚Šæ¡† */
            border-radius: 0;  /* ä¸è¦åœ“è§’ */
            box-shadow: none;  /* ä¸è¦é™°å½± */
            background-color: #f8f9fa;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .notch {
            display: none;     /* æ‰‹æ©Ÿä¸Šéš±è—å‡ç€æµ· */
        }

        /* 2. é›»è…¦ç‰ˆè¦†å¯« (Desktop Override) */
        /* ç•¶è¢å¹•å¯¬åº¦å¤§æ–¼ 768px æ™‚ï¼Œè®Šèº«ç‚ºæ¨¡æ“¬å™¨ */
        @media (min-width: 768px) {
            body {
                background-color: #e5e7eb; /* é›»è…¦ç‰ˆèƒŒæ™¯è‰² (æ·ºç°) */
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .iphone-frame {
                width: 375px;      /* é–å®šå¯¬åº¦ï¼Œä¸å†ç¸®æ”¾ */
                height: 812px;     /* é–å®šé«˜åº¦ */
                border: 12px solid #1f2937; /* åŠ å›é‚Šæ¡† */
                border-radius: 3rem;        /* åŠ å›åœ“è§’ */
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); /* åŠ å›é™°å½± */
                margin: 20px auto; /* åŠ ä¸Šå¤–è· */
            }

            .notch {
                display: block;    /* é›»è…¦ç‰ˆé¡¯ç¤ºå‡ç€æµ· */
                position: absolute; 
                top: 0; 
                left: 50%; 
                transform: translateX(-50%); 
                width: 120px; 
                height: 25px; 
                background-color: #1f2937; 
                border-bottom-left-radius: 16px; 
                border-bottom-right-radius: 16px; 
                z-index: 50;
            }
        }
        
        #checkinModal { transition: opacity 0.3s ease; }
        #checkinModal.active { display: flex; }
        
        .store-card { background: white; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); padding: 20px; border: 1px solid #fef3c7; }
        .game-img { width: 100%; height: 220px; object-fit: cover; border-radius: 12px; margin-bottom: 16px; border: 1px solid #f3f4f6; background-color: #f3f4f6; }
        
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body class="font-sans text-gray-800">

    <div class="iphone-frame">
        <div class="notch"></div>
        <div class="w-full pt-3 pb-2 px-6 bg-white z-20 flex justify-between items-end border-b border-gray-50">
            <span class="text-xs font-bold text-gray-800">09:41</span>
            <div class="flex gap-1.5 text-gray-800">
                <i class="fas fa-signal text-xs"></i><i class="fas fa-wifi text-xs"></i><i class="fas fa-battery-full text-xs"></i>
            </div>
        </div>

        <div id="content-area" class="flex-1 overflow-y-auto no-scrollbar relative bg-[#f8f9fa] pb-16">
            
            <!-- VIEW 1: é¦–é  -->
            <div id="view-home" class="view-section p-4 space-y-4">
                <div class="flex justify-between items-center mb-2 px-1">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border-2 border-white shadow-sm"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" /></div>
                        <div><p class="text-[10px] text-gray-500">æ—©å®‰,</p><h2 class="font-bold text-lg text-gray-800 leading-tight">ç‹å¤§æ˜</h2></div>
                    </div>
                    <button class="w-9 h-9 rounded-full bg-white shadow-sm flex items-center justify-center text-gray-600 hover:text-mvp-main transition" onclick="switchView('shop')"><i class="fas fa-shopping-bag"></i></button>
                </div>

                <div class="bg-gradient-to-r from-[#00b09b] to-[#96c93d] p-5 rounded-2xl shadow-lg text-white relative overflow-hidden">
                    <div class="flex justify-between items-start mb-4 relative z-10">
                        <div><p class="text-xs opacity-90 mb-1 font-bold">æ¨‚æ´»é»é¤˜é¡</p><div class="flex items-baseline gap-2"><span class="text-4xl font-bold tracking-tight">1,250</span><span class="text-sm font-medium">Pts</span></div></div>
                        <div class="bg-white/20 backdrop-blur-sm border border-white/30 px-3 py-1 rounded-full text-xs font-bold shadow-sm">ğŸ† å¥åº·æ¢ç´¢å®¶ Lv.4</div>
                    </div>
                    <div class="relative z-10">
                        <div class="flex justify-between text-[10px] mb-1 opacity-90 font-medium"><span>è·é›¢ä¸‹ä¸€ç­‰ç´š</span><span>é‚„å·® 1,250 Pts</span></div>
                        <div class="w-full bg-black/20 h-2 rounded-full overflow-hidden"><div class="bg-white h-full rounded-full w-[50%] shadow-sm"></div></div>
                    </div>
                </div>

                <!-- ä»Šæ—¥ä»»å‹™ -->
                <div>
                    <div class="flex justify-between items-center mb-3"><h3 class="font-bold text-gray-700 text-sm ml-1 flex items-center gap-2"><i class="fas fa-list-check text-orange-500"></i> ä»Šæ—¥ä»»å‹™</h3><button class="text-[10px] text-gray-400 bg-white px-2 py-1 rounded border border-gray-200">å‰å¾€ä»»å‹™ä¸­å¿ƒ <i class="fas fa-arrow-right"></i></button></div>
                    <div class="space-y-3">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                            <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-femh-100 text-mvp-main flex items-center justify-center text-lg"><i class="fas fa-file-medical"></i></div><div><h4 class="font-bold text-sm text-gray-800">æ¯æ—¥å¥åº·æ—¥èªŒ</h4><p class="text-[10px] text-gray-500">ç´€éŒ„ç”Ÿç†æ•¸æ“š</p></div></div>
                            <button onclick="toggleModal(true)" class="bg-mvp-main text-white text-xs px-3 py-1.5 rounded-full font-bold">å‰å¾€</button>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                            <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center text-lg"><i class="fas fa-gamepad"></i></div><div><h4 class="font-bold text-sm text-gray-800">è…¦å¥åº·é›éŠ</h4><p class="text-[10px] text-gray-500">å®Œæˆä»Šæ—¥è¨“ç·´</p></div></div>
                            <button onclick="switchView('training')" class="bg-blue-500 text-white text-xs px-3 py-1.5 rounded-full font-bold">å‰å¾€</button>
                        </div>
                    </div>
                </div>

                <!-- äºæ±è¡›æ•™å°ˆå€ -->
                <div class="mt-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-gray-700 text-sm ml-1 flex items-center gap-2">
                            <i class="fas fa-book-medical text-femh-500"></i> äºæ±è¡›æ•™å°ˆå€
                        </h3>
                        <button onclick="switchView('articles')" class="text-[10px] text-gray-400 bg-white px-2 py-1 rounded border border-gray-200 hover:text-femh-600 transition">æŸ¥çœ‹æ›´å¤š <i class="fas fa-arrow-right"></i></button>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden" id="home-articles-container">
                        <!-- ç”± JS æ¸²æŸ“ -->
                    </div>
                </div>
            </div>

            <!-- VIEW: è¡›æ•™æ–‡ç« åˆ—è¡¨ -->
            <div id="view-articles" class="view-section hidden p-0 h-full flex flex-col bg-gray-50">
                <div class="p-4 bg-white border-b flex items-center gap-3 shadow-sm z-10">
                    <button onclick="switchView('home')"><i class="fas fa-arrow-left text-gray-600"></i></button>
                    <h2 class="font-bold text-lg text-gray-800">è¡›æ•™æ–‡ç« </h2>
                </div>
                <div id="all-articles-container" class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar pb-24">
                    <!-- ç”± JS æ¸²æŸ“ -->
                </div>
            </div>

            <!-- VIEW 2: è¨“ç·´ -->
            <div id="view-training" class="view-section hidden p-4 space-y-4">
                <div class="bg-white p-5 rounded-b-3xl shadow-sm border-b border-gray-50 mb-2"><h2 class="text-xl font-bold text-gray-800 tracking-tight">è…¦å¥åº·è¨“ç·´</h2><p class="text-xs text-gray-500 mt-1">é‡å°æ ¸å¿ƒèªçŸ¥ç¶­åº¦è¨­è¨ˆ</p></div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-3"><div class="w-10 h-10 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center text-lg"><i class="fas fa-brain"></i></div><div><h4 class="font-bold text-sm">è¨˜æ†¶åŠ›è¨“ç·´</h4><p class="text-[10px] text-gray-400">åœ–å½¢é…å°</p></div><button onclick="simulateGame('è¨˜æ†¶åŠ›', 90)" class="w-full bg-gray-50 text-gray-600 text-xs py-2 rounded-lg font-bold">æ¨¡æ“¬å®Œæˆ</button><button onclick="showLeaderboard('è¨˜æ†¶åŠ›')" class="w-full border border-gray-200 text-gray-400 text-[10px] py-1 rounded-lg">æŸ¥çœ‹æ’è¡Œæ¦œ</button></div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-3"><div class="w-10 h-10 rounded-lg bg-yellow-100 text-yellow-600 flex items-center justify-center text-lg"><i class="fas fa-eye"></i></div><div><h4 class="font-bold text-sm">å°ˆæ³¨åŠ›è¨“ç·´</h4><p class="text-[10px] text-gray-400">è¦–è¦ºè¿½è¹¤</p></div><button onclick="simulateGame('å°ˆæ³¨åŠ›', 85)" class="w-full bg-gray-50 text-gray-600 text-xs py-2 rounded-lg font-bold">æ¨¡æ“¬å®Œæˆ</button><button onclick="showLeaderboard('å°ˆæ³¨åŠ›')" class="w-full border border-gray-200 text-gray-400 text-[10px] py-1 rounded-lg">æŸ¥çœ‹æ’è¡Œæ¦œ</button></div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-3"><div class="w-10 h-10 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center text-lg"><i class="fas fa-tasks"></i></div><div><h4 class="font-bold text-sm">åŸ·è¡ŒåŠ›è¨“ç·´</h4><p class="text-[10px] text-gray-400">æ‰¾é›¶éŒ¢å¤§å¸«</p></div><button onclick="simulateGame('åŸ·è¡ŒåŠ›', 88)" class="w-full bg-gray-50 text-gray-600 text-xs py-2 rounded-lg font-bold">æ¨¡æ“¬å®Œæˆ</button><button onclick="showLeaderboard('åŸ·è¡ŒåŠ›')" class="w-full border border-gray-200 text-gray-400 text-[10px] py-1 rounded-lg">æŸ¥çœ‹æ’è¡Œæ¦œ</button></div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-3"><div class="w-10 h-10 rounded-lg bg-green-100 text-green-600 flex items-center justify-center text-lg"><i class="fas fa-shield-alt"></i></div><div><h4 class="font-bold text-sm">å®‰å¿ƒè­·è…¦</h4><p class="text-[10px] text-gray-400">ç¶œåˆæ”¾é¬†</p></div><button onclick="simulateGame('å®‰å¿ƒè­·è…¦', 100)" class="w-full bg-gray-50 text-gray-600 text-xs py-2 rounded-lg font-bold">æ¨¡æ“¬å®Œæˆ</button><button onclick="showLeaderboard('å®‰å¿ƒè­·è…¦')" class="w-full border border-gray-200 text-gray-400 text-[10px] py-1 rounded-lg">æŸ¥çœ‹æ’è¡Œæ¦œ</button></div>
                </div>
            </div>

            <!-- VIEW 3: ç¯©æª¢ -->
            <div id="view-screening" class="view-section hidden p-4 space-y-4">
                <div class="bg-white p-5 rounded-b-3xl shadow-sm border-b border-gray-50 mb-2"><h2 class="text-xl font-bold text-gray-800 tracking-tight">å¥åº·ç¯©æª¢</h2><p class="text-xs text-gray-500 mt-1">é€éæƒ…å¢ƒäº’å‹•ï¼Œäº†è§£æ‚¨çš„ç‹€æ…‹</p></div>
                <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-5 rounded-2xl shadow-sm border border-orange-200 relative overflow-hidden">
                    <div class="relative z-10"><div class="flex items-center gap-2 mb-2"><span class="bg-orange-500 text-white text-[10px] px-2 py-0.5 rounded font-bold">æƒ…å¢ƒäº’å‹•</span><h3 class="font-bold text-lg text-gray-800">å¹¸ç¦æŸ‘ä»”åº—ï¼šé–‹åº—ä»»å‹™</h3></div><p class="text-xs text-gray-600 mb-4 w-3/4">åŒ–èº«ä¸€æ—¥åº—é•·ï¼Œè™•ç†é€²è²¨ã€çµå¸³èˆ‡é„°å±…äº’å‹•ã€‚</p><button onclick="startStoreGame()" class="bg-orange-500 text-white px-5 py-2 rounded-full text-sm font-bold shadow-lg active:scale-95 transition">é–‹å§‹é–‹åº— (0/8)</button></div>
                    <i class="fas fa-store absolute -right-4 -bottom-4 text-8xl text-orange-200 opacity-50"></i>
                </div>
                <div class="bg-gradient-to-br from-pink-50 to-pink-100 p-5 rounded-2xl shadow-sm border border-pink-200 relative overflow-hidden">
                    <div class="relative z-10"><div class="flex items-center gap-2 mb-2"><span class="bg-pink-500 text-white text-[10px] px-2 py-0.5 rounded font-bold">èŠå¤©æª¢æ¸¬</span><h3 class="font-bold text-lg text-gray-800">å°æ¨‚çš„å¿ƒæƒ…æº«åº¦è¨ˆ</h3></div><p class="text-xs text-gray-600 mb-4 w-3/4">èˆ‡å°æ¨‚èŠèŠå¤©ï¼Œæ•´ç†æœ€è¿‘çš„æƒ…ç·’èˆ‡ç¡çœ å“è³ªã€‚</p><button onclick="startMoodChat()" class="bg-pink-500 text-white px-5 py-2 rounded-full text-sm font-bold shadow-lg active:scale-95 transition">é–‹å§‹èŠå¤©</button></div>
                    <i class="fas fa-comments absolute -right-4 -bottom-4 text-8xl text-pink-200 opacity-50"></i>
                </div>
            </div>

            <!-- VIEW 4: åˆ†æ -->
            <div id="view-analysis" class="view-section hidden h-full flex flex-col">
                <div class="p-5 pt-6 pb-2 bg-[#f8f9fa] z-10 flex-none"><h2 class="text-xl font-bold tracking-tight text-gray-800">æ•¸æ“šèˆ‡è¶¨å‹¢åˆ†æ</h2></div>
                <div class="flex-1 overflow-y-auto p-5 space-y-6 no-scrollbar pb-24">
                    <!-- ç”Ÿç†æ•¸æ“šè¼¸å…¥ (é è¨­å±•é–‹) -->
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-gray-700 text-sm flex items-center gap-2"><i class="fas fa-heartbeat text-red-500"></i> ç”Ÿç†æ•¸æ“šéŒ„å…¥</h3><button onclick="simulateLinkDevice('Health')" class="text-[10px] bg-gray-100 text-gray-500 px-2 py-1 rounded border hover:bg-gray-200"><i class="fas fa-link"></i> é€£å‹•è£ç½®</button></div>
                        <div id="input-setup-mode" class=""><p class="text-xs text-gray-500 mb-3 bg-yellow-50 p-2 rounded text-center">ğŸ‘‹ åˆæ¬¡è¦‹é¢ï¼è«‹å…ˆè¨­å®šåŸºæœ¬è³‡æ–™</p><div class="flex gap-3 mb-3"><input id="setup-height" type="number" placeholder="èº«é«˜ (cm)" class="w-full p-2 border rounded-lg text-sm text-center bg-gray-50"><input id="setup-weight" type="number" placeholder="é«”é‡ (kg)" class="w-full p-2 border rounded-lg text-sm text-center bg-gray-50"></div><button onclick="completeSetup()" class="w-full bg-mvp-main text-white py-2 rounded-lg text-sm font-bold shadow-sm">å»ºç«‹å¥åº·æª”æ¡ˆ</button></div>
                        <div id="input-daily-mode" class="hidden space-y-4">
                            <div class="space-y-2"><label class="text-[11px] font-bold text-gray-400 uppercase tracking-widest">ä»Šæ—¥å¿ƒæƒ…</label><div class="flex justify-between gap-1"><button class="mood-btn flex-1 py-2 bg-gray-50 rounded-lg text-lg hover:bg-yellow-50 border border-transparent" onclick="selectMood(this)">ğŸ˜€</button><button class="mood-btn flex-1 py-2 bg-gray-50 rounded-lg text-lg hover:bg-yellow-50 border border-transparent" onclick="selectMood(this)">ğŸ™‚</button><button class="mood-btn flex-1 py-2 bg-gray-50 rounded-lg text-lg hover:bg-yellow-50 border border-transparent" onclick="selectMood(this)">ğŸ˜</button><button class="mood-btn flex-1 py-2 bg-gray-50 rounded-lg text-lg hover:bg-yellow-50 border border-transparent" onclick="selectMood(this)">ğŸ˜Ÿ</button><button class="mood-btn flex-1 py-2 bg-gray-50 rounded-lg text-lg hover:bg-yellow-50 border border-transparent" onclick="selectMood(this)">ğŸ˜«</button></div></div>
                            <div class="bg-gray-50 p-3 rounded-xl border border-gray-100"><p class="text-[10px] font-bold text-gray-500 mb-2">ä¸‰é«˜èˆ‡å¿ƒè‚ºæŒ‡æ¨™</p><div class="grid grid-cols-3 gap-2 mb-2"><div class="flex-1"><p class="text-[9px] text-gray-400 mb-1">æ”¶ç¸®å£“</p><input id="daily-sys" type="number" placeholder="-" class="w-full p-2 border rounded-lg text-xs text-center bg-white focus:border-mvp-main outline-none"></div><div class="flex-1"><p class="text-[9px] text-gray-400 mb-1">èˆ’å¼µå£“</p><input id="daily-dia" type="number" placeholder="-" class="w-full p-2 border rounded-lg text-xs text-center bg-white focus:border-mvp-main outline-none"></div><div class="flex-1"><p class="text-[9px] text-gray-400 mb-1">å¿ƒè·³</p><input id="daily-bpm" type="number" placeholder="-" class="w-full p-2 border rounded-lg text-xs text-center bg-white focus:border-mvp-main outline-none"></div></div><div class="grid grid-cols-2 gap-2"><div class="flex-1"><p class="text-[9px] text-gray-400 mb-1">è¡€ç³– (mg/dL)</p><input id="daily-glucose" type="number" placeholder="-" class="w-full p-2 border rounded-lg text-xs text-center bg-white focus:border-mvp-main outline-none"></div><div class="flex-1"><p class="text-[9px] text-gray-400 mb-1">ç¡çœ  (hr)</p><input id="daily-sleep" type="number" placeholder="-" class="w-full p-2 border rounded-lg text-xs text-center bg-white focus:border-mvp-main outline-none"></div></div></div>
                            <button onclick="alert('ä»Šæ—¥æ•¸æ“šå·²å„²å­˜ï¼')" class="w-full bg-mvp-main text-white py-2.5 rounded-xl text-sm font-bold shadow-md active:scale-95 transition">å„²å­˜ç´€éŒ„</button>
                        </div>
                    </div>
                    <!-- æ­¥æ•¸è¼¸å…¥ -->
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-700 text-sm mb-3 flex items-center gap-2"><i class="fas fa-shoe-prints text-orange-500"></i> ä»Šæ—¥æ­¥æ•¸</h3>
                        <div class="flex gap-3 items-center"><div class="relative flex-1"><input id="analysis-steps" type="number" placeholder="0" class="w-full p-3 bg-orange-50 rounded-xl text-lg font-bold text-orange-600 border-none outline-none text-center"><span class="absolute right-3 top-1/2 -translate-y-1/2 text-xs text-orange-300">steps</span></div><button onclick="simulateLinkDevice('Step')" class="bg-white border border-gray-200 p-3 rounded-xl text-gray-500 hover:text-orange-500 transition shadow-sm"><i class="fas fa-sync-alt"></i></button></div>
                    </div>
                    <!-- è¶¨å‹¢åœ–è¡¨ -->
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex bg-gray-100 p-1 rounded-lg mb-4"><button id="mode-brain" onclick="toggleChartMode('brain')" class="flex-1 py-1.5 text-xs font-bold rounded bg-white shadow-sm text-mvp-main transition">è…¦åŠ›è¶¨å‹¢</button><button id="mode-health" onclick="toggleChartMode('health')" class="flex-1 py-1.5 text-xs font-medium text-gray-500 transition">ç”Ÿç†è¶¨å‹¢</button></div>
                        <div id="filters-brain" class="flex gap-2 overflow-x-auto no-scrollbar mb-4 pb-1"><button class="chart-filter active px-3 py-1 bg-mvp-main text-white rounded-full text-[10px] font-bold whitespace-nowrap" onclick="updateChartData('brain', 'attention')">æ³¨æ„åŠ›</button><button class="chart-filter px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-[10px] whitespace-nowrap" onclick="updateChartData('brain', 'executive')">åŸ·è¡ŒåŠ›</button><button class="chart-filter px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-[10px] whitespace-nowrap" onclick="updateChartData('brain', 'focus')">å°ˆæ³¨åŠ›</button></div>
                        <div id="filters-health" class="hidden flex-col gap-2 mb-4">
                            <div class="flex gap-2 overflow-x-auto no-scrollbar"><button class="chart-filter-h-metric active px-3 py-1 bg-blue-500 text-white rounded-full text-[10px] font-bold whitespace-nowrap" onclick="updateChartHealthMetric('bp', this)">è¡€å£“</button><button class="chart-filter-h-metric px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-[10px] whitespace-nowrap" onclick="updateChartHealthMetric('hr', this)">å¿ƒè·³</button><button class="chart-filter-h-metric px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-[10px] whitespace-nowrap" onclick="updateChartHealthMetric('glucose', this)">è¡€ç³–</button><button class="chart-filter-h-metric px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-[10px] whitespace-nowrap" onclick="updateChartHealthMetric('steps', this)">æ­¥æ•¸</button></div>
                            <div class="flex gap-2 justify-end"><button class="chart-filter-h-time active text-[9px] text-blue-600 font-bold underline" onclick="updateChartHealthTime(7, this)">7å¤©</button><button class="chart-filter-h-time text-[9px] text-gray-400" onclick="updateChartHealthTime(14, this)">14å¤©</button><button class="chart-filter-h-time text-[9px] text-gray-400" onclick="updateChartHealthTime(30, this)">30å¤©</button></div>
                        </div>
                        <div class="h-56 w-full"><canvas id="analysisChart"></canvas></div>
                    </div>
                    <!-- å¥åº·æ´å¯Ÿ -->
                    <div class="bg-gradient-to-br from-white to-[#e0f7fa] p-4 rounded-xl shadow-sm border border-cyan-100">
                        <h3 class="font-bold text-gray-700 mb-2 flex items-center gap-2"><i class="fas fa-robot text-blue-500"></i> AI å¥åº·è¶¨å‹¢æ´å¯Ÿ</h3>
                        <p id="ai-insight-text" class="text-xs text-gray-600 leading-relaxed">AI åˆ†æï¼šæ‚¨çš„<span class="font-bold text-mvp-main">æ³¨æ„åŠ›</span>è¿‘æœŸè¡¨ç¾ç©©å®šä¸Šå‡ã€‚è‹¥æƒ³é€²ä¸€æ­¥çªç ´ï¼Œå»ºè­°åœ¨æ—©ä¸Š 10 é»å‰é€²è¡Œã€Œè¦–è¦ºè¿½è¹¤ã€è¨“ç·´ï¼Œæ•ˆæœæœ€ä½³ã€‚</p>
                    </div>
                    <!-- æ­·å²ç´€éŒ„ -->
                    <div onclick="openHistoryDetail()" class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 cursor-pointer active:bg-gray-50 transition flex justify-between items-center group"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 group-hover:bg-mvp-main group-hover:text-white transition"><i class="fas fa-list"></i></div><div><h3 class="font-bold text-gray-700 text-sm">æ­·å²å¥åº·ç´€éŒ„</h3><p class="text-[10px] text-gray-400">æŸ¥çœ‹è¿‘ä¸‰å€‹æœˆç”Ÿç†æ•¸æ“š (180ç­†)</p></div></div><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                </div>
            </div>

            <!-- VIEW: æ­·å²ç´€éŒ„è©³æƒ… -->
            <div id="view-history-detail" class="view-section hidden p-0 h-full flex flex-col bg-gray-50">
                <div class="p-4 bg-white border-b flex items-center gap-3 shadow-sm z-10"><button onclick="switchView('analysis')"><i class="fas fa-arrow-left text-gray-600"></i></button><h2 class="font-bold text-lg text-gray-800">æ­·å²ç´€éŒ„ (è¿‘3å€‹æœˆ)</h2></div>
                <div id="history-list-container" class="flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar pb-24"></div>
            </div>

            <!-- VIEW 5: æˆ‘çš„ (Profile - Revamp) -->
            <div id="view-profile" class="view-section hidden p-4 space-y-4 h-full flex flex-col bg-gray-50">
                <div class="bg-white p-6 rounded-xl shadow-sm text-center">
                    <div class="w-20 h-20 bg-gray-200 rounded-full mx-auto mb-3 overflow-hidden"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" /></div>
                    <h3 class="font-bold text-lg">ç‹å¤§æ˜</h3><p class="text-xs text-gray-500">æœƒå“¡ID: 8829103</p>
                </div>
                <div class="space-y-4 overflow-y-auto no-scrollbar pb-20">
                    <!-- Group 1 -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-3 border-b border-gray-100 font-bold text-xs text-gray-500 bg-gray-50 px-4">å¸³æˆ¶è¨­å®š</div>
                        <div onclick="openProfileSubView('basic')" class="p-4 flex justify-between items-center active:bg-gray-50 cursor-pointer"><div class="flex items-center gap-3"><i class="fas fa-user-edit text-mvp-main w-5 text-center"></i> <span class="text-sm font-bold text-gray-700">åŸºæœ¬è³‡æ–™è¨­å®š</span></div><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                    </div>
                    <!-- Group 2 -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-3 border-b border-gray-100 font-bold text-xs text-gray-500 bg-gray-50 px-4">æˆæ¬Šèˆ‡ç®¡ç†</div>
                        <div onclick="openProfileSubView('auth')" class="p-4 border-b border-gray-100 flex justify-between items-center active:bg-gray-50 cursor-pointer"><div class="flex items-center gap-3"><i class="fas fa-shield-alt text-mvp-main w-5 text-center"></i> <span class="text-sm font-bold text-gray-700">æˆæ¬ŠåŒæ„</span></div><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                        <div onclick="openProfileSubView('notify')" class="p-4 flex justify-between items-center active:bg-gray-50 cursor-pointer"><div class="flex items-center gap-3"><i class="fas fa-bell text-mvp-main w-5 text-center"></i> <span class="text-sm font-bold text-gray-700">é€šçŸ¥è¨­å®š</span></div><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                    </div>
                    <!-- Group 3 -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-3 border-b border-gray-100 font-bold text-xs text-gray-500 bg-gray-50 px-4">ç´€éŒ„æŸ¥çœ‹</div>
                        <div onclick="openProfileSubView('records-interaction')" class="p-4 border-b border-gray-100 flex justify-between items-center active:bg-gray-50 cursor-pointer"><div class="flex items-center gap-3"><i class="fas fa-history text-mvp-main w-5 text-center"></i> <span class="text-sm font-bold text-gray-700">äº’å‹•ç´€éŒ„åˆ—è¡¨</span></div><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                        <div onclick="openProfileSubView('records-task')" class="p-4 border-b border-gray-100 flex justify-between items-center active:bg-gray-50 cursor-pointer"><div class="flex items-center gap-3"><i class="fas fa-tasks text-mvp-main w-5 text-center"></i> <span class="text-sm font-bold text-gray-700">ä»»å‹™å®Œæˆç´€éŒ„</span></div><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                        <div onclick="openProfileSubView('records-points')" class="p-4 flex justify-between items-center active:bg-gray-50 cursor-pointer"><div class="flex items-center gap-3"><i class="fas fa-coins text-mvp-main w-5 text-center"></i> <span class="text-sm font-bold text-gray-700">ç©åˆ†å¸³å‹™æ˜ç´°</span></div><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                    </div>
                    <!-- Group 4: Support -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-3 border-b border-gray-100 font-bold text-xs text-gray-500 bg-gray-50 px-4">å”åŠ©èˆ‡æ”¯æ´</div>
                        <div onclick="openProfileSubView('service')" class="p-4 flex justify-between items-center active:bg-gray-50 cursor-pointer"><div class="flex items-center gap-3"><i class="fas fa-headset text-mvp-main w-5 text-center"></i> <span class="text-sm font-bold text-gray-700">å®¢æœä¸­å¿ƒ</span></div><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                    </div>
                </div>
            </div>

            <!-- Profile SubViews Container -->
            <div id="profile-subviews-container" class="absolute inset-0 z-50 bg-gray-50 flex flex-col hidden animate-slide-up">
                <div id="subview-header" class="p-4 bg-white border-b flex items-center gap-3 shadow-sm z-10"><button onclick="closeProfileSubView()"><i class="fas fa-arrow-left text-gray-600"></i></button><h2 class="font-bold text-lg text-gray-800" id="subview-title">æ¨™é¡Œ</h2></div>
                <div id="subview-content" class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar pb-24"></div>
            </div>

            <!-- MODALS & OVERLAYS (Existing) -->
            <div id="view-leaderboard" class="absolute inset-0 bg-white z-50 flex flex-col hidden">
                <div class="p-4 border-b flex items-center gap-2"><button onclick="closeLeaderboard()"><i class="fas fa-arrow-left"></i></button><h3 class="font-bold">æ’è¡Œæ¦œ</h3></div>
                <div class="p-6 text-center space-y-6">
                    <div class="w-24 h-24 bg-yellow-100 rounded-full flex items-center justify-center mx-auto text-4xl">ğŸ‘‘</div>
                    <div><h2 class="text-2xl font-bold text-gray-800" id="lb-game-name">è¨˜æ†¶åŠ›</h2><p class="text-sm text-gray-500">æ‚¨çš„æœ€ä½³æˆç¸¾</p></div>
                    <div class="text-5xl font-bold text-mvp-main" id="lb-score">92</div>
                    <div class="bg-gray-50 p-4 rounded-xl"><p class="text-sm text-gray-600">æ‚¨çš„è¡¨ç¾å„ªæ–¼ <span class="font-bold text-mvp-main">85%</span> çš„åŒé½¡ä½¿ç”¨è€…</p></div>
                </div>
            </div>
            
            <div id="view-store-game" class="absolute inset-0 bg-[#fffbeb] z-50 flex flex-col hidden">
                <div class="p-4 border-b border-orange-100 flex justify-between items-center bg-white/80 backdrop-blur-sm"><button onclick="closeStoreGame()" class="text-gray-400"><i class="fas fa-times"></i></button><div class="font-bold text-gray-800">å¹¸ç¦æŸ‘ä»”åº—</div><div class="text-xs font-bold text-orange-500 bg-orange-100 px-2 py-1 rounded-full" id="store-level-indicator">é—œå¡ 1/8</div></div>
                <div class="flex-1 p-6 flex flex-col justify-center overflow-y-auto" id="store-game-content"></div>
            </div>

            <div id="view-mood-chat" class="absolute inset-0 bg-white z-50 flex flex-col hidden">
                <div class="p-4 border-b bg-pink-50 flex justify-between items-center"><button onclick="closeMoodChat()" class="text-gray-400"><i class="fas fa-times"></i></button><div class="font-bold text-gray-800">å°æ¨‚çš„å¿ƒæƒ…æº«åº¦è¨ˆ</div><div class="w-6"></div></div>
                <div id="mood-chat-history" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 pb-32"></div>
                <div id="mood-chat-controls" class="absolute bottom-0 left-0 w-full bg-white border-t p-4 pb-12 shadow-lg"></div>
            </div>

            <div id="checkinModal" class="absolute inset-0 bg-black/50 z-50 hidden items-end justify-center">
                <div class="bg-white w-full rounded-t-3xl p-6 animate-slide-up max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg text-gray-800">ğŸ“ å¿«é€Ÿæ‰“å¡</h3><button onclick="toggleModal(false)" class="text-2xl text-gray-400 font-light">Ã—</button></div>
                    <div class="space-y-5">
                        <div><label class="block text-sm font-bold text-gray-700 mb-2">ä»Šå¤©å¿ƒæƒ…å¦‚ä½•ï¼Ÿ</label><div class="flex justify-between px-2 text-3xl"><span>ğŸ˜€</span><span>ğŸ™‚</span><span>ğŸ˜</span><span>ğŸ˜Ÿ</span><span>ğŸ˜«</span></div></div>
                        <button class="w-full bg-mvp-main text-white py-3 rounded-full font-bold shadow-lg" onclick="toggleModal(false); alert('æ‰“å¡æˆåŠŸï¼è©³ç´°æ•¸æ“šè«‹è‡³åˆ†æé ç±¤è¼¸å…¥ã€‚');">æäº¤</button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Bottom Navigation -->
        <nav class="absolute bottom-0 w-full bg-white border-t border-gray-100 h-16 flex justify-around items-center z-40">
            <button onclick="switchView('home')" class="nav-item flex flex-col items-center text-mvp-main w-1/5" id="nav-home"><i class="fas fa-home text-lg mb-0.5"></i><span class="text-[10px]">é¦–é </span></button>
            <button onclick="switchView('training')" class="nav-item flex flex-col items-center text-gray-400 w-1/5" id="nav-training"><i class="fas fa-dumbbell text-lg mb-0.5"></i><span class="text-[10px]">è¨“ç·´</span></button>
            <button onclick="switchView('screening')" class="nav-item flex flex-col items-center text-gray-400 w-1/5" id="nav-screening"><i class="fas fa-clipboard-check text-lg mb-0.5"></i><span class="text-[10px]">ç¯©æª¢</span></button>
            <button onclick="switchView('analysis')" class="nav-item flex flex-col items-center text-gray-400 w-1/5" id="nav-analysis"><i class="fas fa-chart-pie text-lg mb-0.5"></i><span class="text-[10px]">åˆ†æ</span></button>
            <button onclick="switchView('profile')" class="nav-item flex flex-col items-center text-gray-400 w-1/5" id="nav-profile"><i class="fas fa-user text-lg mb-0.5"></i><span class="text-[10px]">æˆ‘çš„</span></button>
        </nav>
        <div class="absolute bottom-1.5 left-1/2 transform -translate-x-1/2 w-32 h-1 bg-gray-800 rounded-full z-50"></div>
    </div>

    <script>
        // ================= ARTICLES LOGIC (NEW) =================
        const articlesData = [
            { title: "å¤±æ™ºç—‡çš„æ—©æœŸåå¤§è­¦è¨Š", date: "2025/01/10", category: "ç–¾ç—…èªè­˜", id: 1 },
            { title: "é é˜²å¤§è…¦é€€åŒ–ï¼šåœ°ä¸­æµ·é£²é£Ÿæ€éº¼åƒï¼Ÿ", date: "2025/01/05", category: "å¥åº·é£²é£Ÿ", id: 2 },
            { title: "é•·è¼©è¨˜æ†¶åŠ›è®Šå·®ï¼Ÿåˆ©ç”¨ AD8 é‡è¡¨è‡ªæˆ‘æª¢æ¸¬", date: "2024/12/28", category: "ç¯©æª¢å·¥å…·", id: 3 },
            { title: "è¦å¾‹é‹å‹•å°å¤§è…¦çš„å¥½è™•ï¼šæ¯é€± 150 åˆ†é˜", date: "2024/12/15", category: "é‹å‹•ä¿å¥", id: 4 },
            { title: "å¦‚ä½•èˆ‡å¤±æ™ºç—‡é•·è¼©æºé€šï¼Ÿç…§è­·æŠ€å·§åˆ†äº«", date: "2024/12/01", category: "ç…§è­·è³‡æº", id: 5 }
        ];

        function renderArticles() {
            const homeContainer = document.getElementById('home-articles-container');
            const allContainer = document.getElementById('all-articles-container');
            
            if(!homeContainer || !allContainer) return;

            // Render Home (Top 3)
            let homeHtml = '';
            articlesData.slice(0, 3).forEach(art => {
                homeHtml += `
                    <div class="p-3 border-b last:border-b-0 border-gray-50 hover:bg-gray-50 transition cursor-pointer" onclick="alert('é–‹å•Ÿæ–‡ç« ï¼š${art.title}')">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="text-[9px] bg-femh-100 text-femh-600 px-1.5 py-0.5 rounded font-bold mb-1 inline-block">${art.category}</span>
                                <h4 class="font-bold text-xs text-gray-800 leading-snug">${art.title}</h4>
                            </div>
                            <span class="text-[9px] text-gray-400 whitespace-nowrap">${art.date}</span>
                        </div>
                    </div>
                `;
            });
            homeContainer.innerHTML = homeHtml;

            // Render All
            let allHtml = '';
            articlesData.forEach(art => {
                allHtml += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition cursor-pointer" onclick="alert('é–‹å•Ÿæ–‡ç« ï¼š${art.title}')">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] bg-femh-100 text-femh-600 px-2 py-1 rounded-full font-bold">${art.category}</span>
                            <span class="text-[10px] text-gray-400">${art.date}</span>
                        </div>
                        <h3 class="font-bold text-sm text-gray-800 mb-2">${art.title}</h3>
                        <div class="flex items-center text-[10px] text-gray-400 gap-1">
                            <span>äºæ±é†«é™¢ç¥ç¶“é†«å­¸éƒ¨</span>
                            <i class="fas fa-chevron-right ml-auto"></i>
                        </div>
                    </div>
                `;
            });
            allContainer.innerHTML = allHtml;
        }

        // ================= NAVIGATION =================
        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${viewId}`)?.classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('text-mvp-main'); btn.classList.add('text-gray-400');
            });
            const activeNav = document.getElementById(`nav-${viewId}`);
            if(activeNav) { activeNav.classList.remove('text-gray-400'); activeNav.classList.add('text-mvp-main'); }

            if(viewId === 'analysis') { toggleChartMode('brain'); }
        }

        function toggleModal(show) {
            const modal = document.getElementById('checkinModal');
            if(show) modal.classList.add('active'); else modal.classList.remove('active');
        }

        function openHistoryDetail() {
            switchView('history-detail');
            const container = document.getElementById('history-list-container');
            container.innerHTML = '';
            const moods = ['ğŸ˜€', 'ğŸ™‚', 'ğŸ˜', 'ğŸ˜Ÿ'];
            for(let i=0; i<20; i++) {
                const date = new Date(); date.setDate(date.getDate() - i);
                const dateStr = `${date.getMonth()+1}/${date.getDate()}`;
                const sys = 110 + Math.floor(Math.random()*20); const dia = 70 + Math.floor(Math.random()*15); const hr = 65 + Math.floor(Math.random()*15); const steps = 4000 + Math.floor(Math.random()*5000); const mood = moods[Math.floor(Math.random()*moods.length)];
                container.insertAdjacentHTML('beforeend', `<div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-2"><div class="flex justify-between items-center border-b border-gray-50 pb-2"><span class="text-xs font-bold text-gray-600">${dateStr}</span><span class="text-lg">${mood}</span></div><div class="grid grid-cols-3 gap-2 text-center"><div class="bg-gray-50 rounded p-2"><p class="text-[10px] text-gray-400">è¡€å£“</p><p class="text-xs font-bold text-gray-700">${sys}/${dia}</p></div><div class="bg-gray-50 rounded p-2"><p class="text-[10px] text-gray-400">å¿ƒè·³</p><p class="text-xs font-bold text-gray-700">${hr}</p></div><div class="bg-gray-50 rounded p-2"><p class="text-[10px] text-gray-400">æ­¥æ•¸</p><p class="text-xs font-bold text-orange-500">${steps}</p></div></div></div>`);
            }
            container.insertAdjacentHTML('beforeend', `<div class="text-center text-xs text-gray-400 py-4">å·²é¡¯ç¤ºè¿‘ 20 ç­† (å…± 180 ç­†)</div>`);
        }

        // ================= SERVICE LOGIC (NEW) =================
        let serviceTickets = [
            { id: 'T2026011001', date: '2026/01/10', category: 'å¸³è™Ÿèˆ‡èªè­‰', content: 'è«‹å•å¦‚ä½•ä¿®æ”¹æˆ‘çš„ç¶å®šæ‰‹æ©Ÿè™Ÿç¢¼ï¼Ÿç›®å‰æ‰¾ä¸åˆ°é¸é …ã€‚', status: 'å·²å›è¦†', reply: 'è¦ªæ„›çš„ç”¨æˆ¶æ‚¨å¥½ï¼Œè«‹è‡³ã€Œæˆ‘çš„ > å¸³è™Ÿè¨­å®šã€ä¸­é»æ“Šæ‰‹æ©Ÿè™Ÿç¢¼æ¬„ä½é€²è¡Œé©—è­‰ä¿®æ”¹ã€‚' },
            { id: 'T2026011202', date: '2026/01/12', category: 'æ´»å‹•ç›¸é—œ', content: 'åƒåŠ æ­¥æ•¸æŒ‘æˆ°æ´»å‹•ï¼Œä½†é»æ•¸æ²’æœ‰å…¥å¸³ï¼Œè«‹å”åŠ©ç¢ºèªã€‚', status: 'è™•ç†ä¸­', reply: null }
        ];

        function renderServiceTabs(activeTab) {
            const container = document.getElementById('subview-content');
            
            // Tab Header
            let html = `
                <div class="flex bg-gray-100 p-1 rounded-lg mb-4">
                    <button onclick="renderServiceTabs('contact')" class="flex-1 py-2 text-xs font-bold rounded-lg transition-all ${activeTab === 'contact' ? 'bg-white shadow-sm text-mvp-main' : 'text-gray-500'}">æˆ‘è¦æå•</button>
                    <button onclick="renderServiceTabs('history')" class="flex-1 py-2 text-xs font-bold rounded-lg transition-all ${activeTab === 'history' ? 'bg-white shadow-sm text-mvp-main' : 'text-gray-500'}">æå•ç´€éŒ„</button>
                </div>
            `;

            // Content
            if (activeTab === 'contact') {
                html += `
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 space-y-4 animate-fade-in">
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-700">å•é¡Œåˆ†é¡</label>
                            <select id="svc-cat" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm outline-none focus:border-mvp-main">
                                <option>å¸³è™Ÿèˆ‡èªè­‰</option><option>å¥åº·æ•¸æ“šç•°å¸¸</option><option>æ´»å‹•ç›¸é—œ</option><option>å…¶ä»–å»ºè­°</option>
                            </select>
                        </div>
                        <div class="space-y-1 relative">
                            <label class="text-xs font-bold text-gray-700">å•é¡Œæè¿°</label>
                            <textarea id="svc-desc" rows="5" maxlength="500" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm outline-none focus:border-mvp-main" placeholder="è«‹è©³ç´°æè¿°æ‚¨é‡åˆ°çš„å•é¡Œ..."></textarea>
                            <span class="absolute bottom-2 right-2 text-[10px] text-gray-400">0/500</span>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-700">é™„ä»¶ä¸Šå‚³ (é¸å¡«)</label>
                            <div class="flex items-center gap-3">
                                <button onclick="alert('æ¨¡æ“¬é¸æ“‡æª”æ¡ˆ (æœ€å¤š3å¼µ, å–®æª”5MB)')" class="w-20 h-20 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-400 hover:bg-gray-50"><i class="fas fa-plus text-lg"></i><span class="text-[9px] mt-1">ä¸Šå‚³åœ–ç‰‡</span></button>
                                <div class="text-[10px] text-gray-400">æ”¯æ´ JPG, PNG<br>å–®æª”ä¸Šé™ 5MB</div>
                            </div>
                        </div>
                        <button onclick="submitTicket()" class="w-full bg-mvp-main text-white py-3 rounded-xl font-bold shadow-md active:scale-95 transition mt-2">é€å‡ºæå•</button>
                    </div>
                `;
            } else {
                html += `<div class="space-y-3 animate-fade-in">`;
                if(serviceTickets.length === 0) {
                    html += `<div class="text-center py-10 text-gray-400 text-sm">ç›®å‰æ²’æœ‰æå•ç´€éŒ„</div>`;
                } else {
                    serviceTickets.forEach((t, idx) => {
                        const statusColor = t.status === 'å·²å›è¦†' ? 'bg-green-100 text-green-600' : 'bg-orange-100 text-orange-600';
                        html += `
                            <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <div><span class="text-[10px] text-gray-400">${t.date}</span><h4 class="font-bold text-sm text-gray-800">${t.category}</h4></div>
                                    <span class="text-[10px] px-2 py-0.5 rounded-full font-bold ${statusColor}">${t.status}</span>
                                </div>
                                <p class="text-xs text-gray-600 mb-3 line-clamp-2">${t.content}</p>
                                ${t.reply ? `
                                    <div class="bg-gray-50 p-3 rounded-lg text-xs text-gray-600">
                                        <p class="font-bold text-mvp-main mb-1"><i class="fas fa-headset mr-1"></i>å®¢æœå›è¦†ï¼š</p>
                                        ${t.reply}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    });
                }
                html += `</div>`;
            }

            container.innerHTML = html;
        }

        function submitTicket() {
            const cat = document.getElementById('svc-cat').value;
            const desc = document.getElementById('svc-desc').value;
            if(!desc) { alert('è«‹è¼¸å…¥å•é¡Œæè¿°'); return; }

            const newId = 'T' + new Date().toISOString().slice(0,10).replace(/-/g,'') + Math.floor(Math.random()*1000);
            serviceTickets.unshift({
                id: newId,
                date: new Date().toISOString().slice(0,10).replace(/-/g,'/'),
                category: cat,
                content: desc,
                status: 'è™•ç†ä¸­',
                reply: null
            });

            alert('æå•å·²é€å‡ºï¼æˆ‘å€‘æœƒç›¡å¿«å›è¦†æ‚¨ã€‚');
            renderServiceTabs('history');
        }

        // ================= PROFILE SUB-VIEWS LOGIC (Updated) =================
        function openProfileSubView(type) {
            const container = document.getElementById('profile-subviews-container');
            const content = document.getElementById('subview-content');
            const title = document.getElementById('subview-title');
            container.classList.remove('hidden');

            if (type === 'basic') {
                title.innerText = "åŸºæœ¬è³‡æ–™è¨­å®š";
                content.innerHTML = `
                    <div class="bg-white rounded-2xl p-5 shadow-sm border space-y-4">
                        <div class="space-y-1"><label class="text-[10px] text-gray-400">æš±ç¨±</label><input type="text" class="w-full border-b py-2 text-sm outline-none font-medium" value="ç‹å¤§æ˜"></div>
                        <div class="space-y-1"><label class="text-[10px] text-gray-400">æœƒå“¡ ID (å”¯è®€)</label><input type="text" class="w-full border-b py-2 text-sm outline-none text-gray-400" value="8829103" readonly></div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1"><label class="text-[10px] text-gray-400">èº«é«˜ (cm)</label><input type="number" class="w-full border-b py-2 text-sm outline-none font-medium" value="175"></div>
                            <div class="space-y-1"><label class="text-[10px] text-gray-400">é«”é‡ (kg)</label><input type="number" class="w-full border-b py-2 text-sm outline-none font-medium" value="75"></div>
                        </div>
                        <div class="space-y-1"><label class="text-[10px] text-gray-400">ç”Ÿæ—¥</label><input type="date" class="w-full border-b py-2 text-sm outline-none" value="1958-05-20"></div>
                    </div>
                    <button class="w-full bg-mvp-main text-white py-3 rounded-xl font-bold shadow-md" onclick="alert('è³‡æ–™å·²æ›´æ–°ï¼'); closeProfileSubView()">å„²å­˜è®Šæ›´</button>
                `;
            } else if (type === 'auth') {
                title.innerText = "æˆæ¬ŠåŒæ„";
                content.innerHTML = `
                    <div class="bg-white rounded-2xl p-5 shadow-sm border space-y-5">
                        <div class="flex justify-between items-center">
                            <div><p class="text-sm font-bold text-gray-800">ç›¸æ©Ÿæ¬Šé™</p><p class="text-[10px] text-gray-400">ç”¨æ–¼ AI é¤é»åˆ†æèˆ‡è¾¨è­˜</p></div>
                            <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer" checked onchange="if(!this.checked) alert('æ³¨æ„ï¼šé—œé–‰ç›¸æ©Ÿæ¬Šé™å°‡å°è‡´ç„¡æ³•ä½¿ç”¨ AI é¤é»åˆ†æåŠŸèƒ½ï¼')"><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-mvp-main"></div></label>
                        </div>
                        <div class="flex justify-between items-center">
                            <div><p class="text-sm font-bold text-gray-800">å¥åº·æ•¸æ“šåŒæ­¥</p><p class="text-[10px] text-gray-400">è®€å–æ­¥æ•¸ã€å¿ƒè·³ç­‰ç”Ÿç†è³‡è¨Š</p></div>
                            <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer" checked><div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-mvp-main after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div></label>
                        </div>
                    </div>
                `;
            } else if (type === 'notify') {
                title.innerText = "é€šçŸ¥è¨­å®š";
                content.innerHTML = `
                    <div class="bg-white rounded-2xl p-5 shadow-sm border space-y-5">
                        <div class="flex justify-between items-center">
                            <div><p class="text-sm font-bold text-gray-800">æ¨æ’­é€šçŸ¥ç¸½é–‹é—œ</p><p class="text-[10px] text-gray-400">æ¥æ”¶å¥åº·æé†’èˆ‡ä»»å‹™é€šçŸ¥</p></div>
                            <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer" checked><div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-mvp-main after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div></label>
                        </div>
                        <div class="pt-4 border-t border-gray-100">
                             <p class="text-xs font-bold text-gray-600 mb-2">æé†’é »ç‡</p>
                             <select class="w-full p-3 bg-gray-50 rounded-lg text-sm border-none outline-none"><option>æ¯æ—¥ä¸€æ¬¡ (å»ºè­°)</option><option>æ¯é€±ä¸€æ¬¡</option><option>åƒ…é‡è¦é€šçŸ¥</option></select>
                        </div>
                    </div>
                `;
            } else if (type === 'service') {
                title.innerText = "å®¢æœä¸­å¿ƒ";
                renderServiceTabs('contact');
            } else if (type.startsWith('records')) {
                const recordType = type.split('-')[1];
                let listHtml = '';
                if(recordType === 'interaction') {
                    title.innerText = "äº’å‹•ç´€éŒ„åˆ—è¡¨";
                    listHtml = Array(5).fill(0).map((_,i) => `<div class="bg-white p-3 rounded-lg border border-gray-100 flex justify-between items-center"><div class="flex gap-3 items-center"><div class="w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-500"><i class="fas fa-gamepad"></i></div><div><p class="text-xs font-bold">è¨˜æ†¶åŠ›è¨“ç·´</p><p class="text-[10px] text-gray-400">2026/01/${20-i}</p></div></div><span class="text-sm font-bold text-mvp-main">92åˆ†</span></div>`).join('');
                } else if(recordType === 'task') {
                    title.innerText = "ä»»å‹™å®Œæˆç´€éŒ„";
                    listHtml = Array(5).fill(0).map((_,i) => `<div class="bg-white p-3 rounded-lg border border-gray-100 flex justify-between items-center"><div class="flex gap-3 items-center"><div class="w-8 h-8 rounded-full bg-green-50 flex items-center justify-center text-green-500"><i class="fas fa-check"></i></div><div><p class="text-xs font-bold">æ¯æ—¥å¥åº·æ—¥èªŒ</p><p class="text-[10px] text-gray-400">2026/01/${20-i}</p></div></div><span class="text-xs text-gray-400">å·²å®Œæˆ</span></div>`).join('');
                } else {
                    title.innerText = "ç©åˆ†å¸³å‹™æ˜ç´°";
                    listHtml = Array(5).fill(0).map((_,i) => `<div class="bg-white p-3 rounded-lg border border-gray-100 flex justify-between items-center"><div class="flex gap-3 items-center"><div class="w-8 h-8 rounded-full bg-orange-50 flex items-center justify-center text-orange-500"><i class="fas fa-coins"></i></div><div><p class="text-xs font-bold">å®Œæˆè¨“ç·´çå‹µ</p><p class="text-[10px] text-gray-400">2026/01/${20-i}</p></div></div><span class="text-sm font-bold text-orange-500">+20</span></div>`).join('');
                }
                content.innerHTML = `<div class="space-y-2">${listHtml}</div>`;
            }
        }
        
        function closeProfileSubView() {
            document.getElementById('profile-subviews-container').classList.add('hidden');
        }

        // ================= ANALYSIS LOGIC (Kept same) =================
        let analysisChart = null;
        let currentHealthMetric = 'bp'; 
        let currentHealthDays = 7;

        function completeSetup() {
            const h = document.getElementById('setup-height').value;
            const w = document.getElementById('setup-weight').value;
            if(h && w) { document.getElementById('input-setup-mode').classList.add('hidden'); document.getElementById('input-daily-mode').classList.remove('hidden'); alert(`åŸºæœ¬è³‡æ–™å·²å»ºç«‹ï¼š${h}cm / ${w}kg`); } else { alert('è«‹è¼¸å…¥èº«é«˜èˆ‡é«”é‡'); }
        }
        
        function selectMood(btn) {
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('bg-yellow-100', 'border-yellow-400'));
            btn.classList.add('bg-yellow-100', 'border-yellow-400');
        }

        function simulateLinkDevice(type) {
            const btn = event.currentTarget; const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åŒæ­¥ä¸­...';
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-check"></i> å·²æ›´æ–°';
                btn.classList.add('text-green-600');
                if(type === 'Step') {
                    document.getElementById('analysis-steps').value = 8542;
                } else if (type === 'Health') {
                    document.getElementById('daily-sys').value = 118;
                    document.getElementById('daily-dia').value = 78;
                    document.getElementById('daily-bpm').value = 72;
                    document.getElementById('daily-glucose').value = 98;
                    document.getElementById('daily-sleep').value = 7.5;
                }
                setTimeout(() => { btn.innerHTML = originalText; btn.classList.remove('text-green-600'); }, 2000);
            }, 1200);
        }
        function toggleChartMode(mode) {
            const btnBrain = document.getElementById('mode-brain'); const btnHealth = document.getElementById('mode-health');
            const filtersBrain = document.getElementById('filters-brain'); const filtersHealth = document.getElementById('filters-health');
            if (mode === 'brain') {
                btnBrain.classList.replace('text-gray-500', 'text-mvp-main'); btnBrain.classList.replace('font-medium', 'font-bold'); btnBrain.classList.add('bg-white', 'shadow-sm');
                btnHealth.classList.replace('text-mvp-main', 'text-gray-500'); btnHealth.classList.replace('font-bold', 'font-medium'); btnHealth.classList.remove('bg-white', 'shadow-sm');
                filtersBrain.classList.remove('hidden'); filtersBrain.classList.add('flex'); filtersHealth.classList.add('hidden'); filtersHealth.classList.remove('flex');
                updateChartData('brain', 'attention');
            } else {
                btnHealth.classList.replace('text-gray-500', 'text-mvp-main'); btnHealth.classList.replace('font-medium', 'font-bold'); btnHealth.classList.add('bg-white', 'shadow-sm');
                btnBrain.classList.replace('text-mvp-main', 'text-gray-500'); btnBrain.classList.replace('font-bold', 'font-medium'); btnBrain.classList.remove('bg-white', 'shadow-sm');
                filtersHealth.classList.remove('hidden'); filtersHealth.classList.add('flex'); filtersBrain.classList.add('hidden'); filtersBrain.classList.remove('flex');
                updateChartData('health', 7);
            }
        }

        // Logic for Health Chart Filters (Metric & Time)
        function updateChartHealthMetric(metric, btn) {
            currentHealthMetric = metric;
            document.querySelectorAll('.chart-filter-h-metric').forEach(b => {
                b.classList.remove('bg-blue-500', 'text-white');
                b.classList.add('bg-gray-100', 'text-gray-500');
            });
            btn.classList.remove('bg-gray-100', 'text-gray-500');
            btn.classList.add('bg-blue-500', 'text-white');
            updateChartData('health', currentHealthDays);
        }

        function updateChartHealthTime(days, btn) {
            currentHealthDays = days;
            document.querySelectorAll('.chart-filter-h-time').forEach(b => {
                b.classList.remove('underline', 'text-blue-600', 'font-bold');
                b.classList.add('text-gray-400');
            });
            btn.classList.remove('text-gray-400');
            btn.classList.add('underline', 'text-blue-600', 'font-bold');
            updateChartData('health', days);
        }

        function updateChartData(mode, subType) {
            const ctx = document.getElementById('analysisChart');
            if(analysisChart) analysisChart.destroy();
            let labels = [], dataset = [], label = "", color = mode === 'brain' ? '#00b09b' : '#3b82f6';
            const insightText = document.getElementById('ai-insight-text');

            if (mode === 'brain') {
                const btnSelector = '.chart-filter';
                 document.querySelectorAll(btnSelector).forEach(btn => { btn.classList.remove('bg-mvp-main', 'text-white'); btn.classList.add('bg-gray-100', 'text-gray-500'); });
                if(event && event.target.classList.contains('chart-filter')) {
                    event.target.classList.remove('bg-gray-100', 'text-gray-500'); event.target.classList.add('bg-mvp-main', 'text-white');
                }

                labels = ['G1', 'G2', 'G3', 'G4', 'G5', 'G6', 'G7', 'G8', 'G9', 'G10'];
                if(subType === 'attention') { 
                    dataset = [70,72,75,74,78,80,82,81,85,88]; label = 'æ³¨æ„åŠ› (åˆ†)'; 
                    if(insightText) insightText.innerHTML = `AI åˆ†æï¼šæ‚¨çš„<span class="font-bold text-mvp-main">æ³¨æ„åŠ›åˆ†æ•¸</span>åœ¨éå» 5 æ¬¡è¨“ç·´ä¸­ç©©å®šä¸Šå‡ã€‚å»ºè­°åœ¨æ—©ä¸Šç²¾ç¥å¥½æ™‚é€²è¡Œè¨“ç·´ï¼Œæ•ˆæœæœ€ä½³ã€‚`;
                }
                else if(subType === 'executive') { 
                    dataset = [60,65,62,68,70,75,73,78,80,82]; label = 'åŸ·è¡ŒåŠ› (åˆ†)';
                    if(insightText) insightText.innerHTML = `AI åˆ†æï¼šæ‚¨çš„<span class="font-bold text-mvp-main">åŸ·è¡ŒåŠ›</span>ç•¥æœ‰æ³¢å‹•ã€‚ç ”ç©¶æŒ‡å‡ºï¼Œåˆç¡ 20 åˆ†é˜æœ‰åŠ©æ–¼æå‡ä¸‹åˆçš„æ±ºç­–åŸ·è¡Œæ•ˆç‡ã€‚`;
                }
                else if(subType === 'focus') { 
                    dataset = [50,55,60,65,70,72,75,80,82,85]; label = 'å°ˆæ³¨åŠ› (åˆ†)';
                    if(insightText) insightText.innerHTML = `AI åˆ†æï¼š<span class="font-bold text-mvp-main">å°ˆæ³¨åŠ›</span>ç¶­æŒåœ¨é«˜æª”ã€‚è‹¥æ„Ÿåˆ°ç–²å‹ï¼Œè«‹é©åº¦ä¼‘æ¯ï¼Œé¿å…éåº¦ç”¨è…¦å°è‡´æ•ˆç‡ä¸‹é™ã€‚`;
                }
            } else {
                let days = subType; 
                for(let i=1; i<=days; i++) labels.push(`D${i}`);
                
                if (currentHealthMetric === 'bp') {
                    label = `æ”¶ç¸®å£“ (mmHg)`;
                    for(let i=0; i<days; i++) dataset.push(118 + Math.floor(Math.random() * 10 - 5));
                    if(insightText) insightText.innerHTML = `AI åˆ†æï¼šæ‚¨çš„<span class="font-bold text-blue-500">è¡€å£“</span>æ§åˆ¶åœ¨æ­£å¸¸ç¯„åœå…§ã€‚è¦å¾‹çš„æœ‰æ°§é‹å‹•ï¼ˆå¦‚å¿«èµ°ï¼‰æœ‰åŠ©æ–¼ç¶­æŒç©©å®šçš„è¡€å£“æ•¸å€¼ã€‚`;
                } else if (currentHealthMetric === 'hr') {
                    label = `å¿ƒè·³ (BPM)`;
                    for(let i=0; i<days; i++) dataset.push(72 + Math.floor(Math.random() * 8 - 4));
                    if(insightText) insightText.innerHTML = `AI åˆ†æï¼š<span class="font-bold text-blue-500">éœæ­¢å¿ƒç‡</span>å¹³å‡ç‚º 72 bpmï¼Œå±¬æ–¼å¥åº·ç¯„ç–‡ã€‚è‹¥å¿ƒç‡ç•°å¸¸å‡é«˜ï¼Œè«‹æª¢è¦–æ˜¯å¦å£“åŠ›éå¤§æˆ–ç¡çœ ä¸è¶³ã€‚`;
                } else if (currentHealthMetric === 'glucose') {
                    label = `è¡€ç³– (mg/dL)`;
                    for(let i=0; i<days; i++) dataset.push(95 + Math.floor(Math.random() * 15 - 5));
                    if(insightText) insightText.innerHTML = `AI åˆ†æï¼š<span class="font-bold text-blue-500">è¡€ç³–</span>æ•¸å€¼å¹³ç©©ã€‚å»ºè­°ç¶­æŒå®šæ™‚å®šé‡çš„é£²é£Ÿç¿’æ…£ï¼Œä¸¦æ¸›å°‘ç²¾ç·»ç³–åˆ†çš„æ”å–ã€‚`;
                } else if (currentHealthMetric === 'steps') {
                    label = `æ­¥æ•¸`;
                    for(let i=0; i<days; i++) dataset.push(5000 + Math.floor(Math.random() * 4000));
                    if(insightText) insightText.innerHTML = `AI åˆ†æï¼šæ‚¨çš„<span class="font-bold text-blue-500">æ­¥æ•¸</span>æ´»èºåº¦æ¥µä½³ï¼æ¯æ—¥æ­¥è¡Œè¶…é 7000 æ­¥å¯æœ‰æ•ˆé™ä½å¿ƒè¡€ç®¡ç–¾ç—…é¢¨éšªã€‚`;
                }
            }

            analysisChart = new Chart(ctx, {
                type: 'line',
                data: { labels: labels, datasets: [{ label: label, data: dataset, borderColor: color, backgroundColor: color + '10', fill: true, tension: 0.4, pointRadius: 2 }] },
                options: { maintainAspectRatio: false, plugins: { legend: { display: true } }, scales: { y: { beginAtZero: false } } }
            });
        }

        // ================= STORE GAME LOGIC =================
        let storeLevel = 0;
        const storeLevels = [
            { title: "é–‹åº—æº–å‚™", desc: "è«‹ç¢ºèªä»Šå¤©çš„æ—¥æœŸ", type: "date", img: "https://i.ibb.co/tPL55zbn/01.jpg" },
            { title: "é€²è²¨æ±ºç­–", desc: "é›»è©±éŸ¿äº†ï¼šã€è€é—†ï¼æœ‰ä¸€æ‰¹è¶…ä¾¿å®œçš„è²¨è¦ä¸è¦ï¼Ÿå…ˆåŒ¯æ¬¾çµ¦æˆ‘ï¼ã€", type: "choice", opts: ["é¦¬ä¸ŠåŒ¯æ¬¾", "æ‹’çµ• (é€™æ˜¯è©é¨™)"], ans: 1, img: "https://i.ibb.co/Gz20CrM/02.jpg" },
            { title: "æ•´ç†è²¨æ¶", desc: "ä»¥å‰æˆ‘å¾ˆæ„›ç ”ç©¶æ–°æ“ºæ³•...", type: "choice", opts: ["ç¾åœ¨æ‡¶å¾—å¼„äº†", "ä¾†æ“ºå€‹æ–°èŠ±æ¨£å§ï¼"], ans: 1, img: "https://i.ibb.co/TxVP53Mv/03.jpg" },
            { title: "é„°å±…é–’èŠ", desc: "è€ç‹èªªï¼šã€Œæ˜¨å¤©æˆ‘æœ‰å»å…¬åœ’å–”!ã€ï¼Œä½ å›æ‡‰...", type: "choice", opts: ["æ˜¨å¤©ä½ å»å“ªè£¡?", "é‚£å…¬åœ’æœ‰ä»€éº¼æ–°è®ŠåŒ–å—"], ans: 1, img: "https://i.ibb.co/pvP0smWT/04.jpg" },
            { title: "ä¿®ç†é›»è¦–", desc: "é›»è¦–è®Šé›ªèŠ±å±äº†...", type: "action", action: "é™æ§å™¨ï¼šè¼¸å…¥æºåˆ‡æ›", img: "https://i.ibb.co/TMsXsc5p/05.jpg" },
            { title: "è¤‡é›œçµå¸³", desc: "ç¸½é‡‘é¡ 345 å…ƒï¼Œå®¢äººçµ¦ 1000 å…ƒã€‚", type: "calc", q: "è¦æ‰¾å¤šå°‘éŒ¢ï¼Ÿ", ans: 655, img: "https://i.ibb.co/gL3K3hLq/06.jpg" },
            { title: "é ç´„é€è²¨", desc: "å®¢äººï¼šã€ä¸‹åˆ 4 é»å¹«æˆ‘é€ç±³åˆ°å®¶ã€", type: "clock", target: 4, img: "https://i.ibb.co/4wsCKtsp/07.jpg" },
            { title: "æ‰¾å°‹ç‰©å“", desc: "è¦é—œåº—äº†ï¼Œé‘°åŒ™ä¸è¦‹äº†ï¼(è«‹é¸æ“‡æ­£ç¢ºçš„å€åŸŸ)", type: "hidden", img: "https://i.ibb.co/5xBC55wP/08.jpg" }
        ];

        function startStoreGame() {
            storeLevel = 0;
            document.getElementById('view-store-game').classList.remove('hidden');
            renderStoreLevel();
        }
        function closeStoreGame() { document.getElementById('view-store-game').classList.add('hidden'); }

        function checkStoreDate() {
            const m = document.getElementById('sel-month').value;
            const d = document.getElementById('sel-day').value;
            const w = document.getElementById('sel-weekday').value;
            if (m && d && w) {
                nextStoreLevel(true);
            } else {
                alert('è«‹å®Œæ•´é¸æ“‡æ—¥æœŸè³‡è¨Šå–”ï¼');
            }
        }

        function renderStoreLevel() {
            if(storeLevel >= storeLevels.length) { renderStoreResult(); return; }
            const level = storeLevels[storeLevel];
            document.getElementById('store-level-indicator').innerText = `é—œå¡ ${storeLevel}/7`;
            const container = document.getElementById('store-game-content');
            
            let imgHtml = level.img 
                ? `<img src="${level.img}" class="game-img" alt="${level.title}">` 
                : `<div class="placeholder-img" data-label="æƒ…å¢ƒç¤ºæ„åœ–"><i class="fas fa-store text-gray-300"></i></div>`;

            let html = `<div class="store-card animate-fade-in"><h3 class="font-bold text-xl mb-2 text-center">${level.title}</h3>${imgHtml}<p class="text-sm text-gray-600 mb-6 text-center leading-relaxed">${level.desc}</p>`;
            
            if(level.type === 'choice') {
                html += `<div class="space-y-3">${level.opts.map((o, i) => `<button onclick="nextStoreLevel(${i === level.ans})" class="w-full py-3 border border-orange-200 rounded-xl text-orange-800 font-bold active:bg-orange-50">${o}</button>`).join('')}</div>`;
            } else if (level.type === 'date') {
                html += `
                <div class="grid grid-cols-3 gap-2 mb-4">
                    <select id="sel-month" class="p-2 border rounded-lg bg-white text-sm"><option value="">æœˆä»½</option>${Array.from({length: 12}, (_, i) => `<option value="${i+1}">${i+1}æœˆ</option>`).join('')}</select>
                    <select id="sel-day" class="p-2 border rounded-lg bg-white text-sm"><option value="">æ—¥æœŸ</option>${Array.from({length: 31}, (_, i) => `<option value="${i+1}">${i+1}æ—¥</option>`).join('')}</select>
                    <select id="sel-weekday" class="p-2 border rounded-lg bg-white text-sm"><option value="">æ˜ŸæœŸ</option><option value="1">é€±ä¸€</option><option value="2">é€±äºŒ</option><option value="3">é€±ä¸‰</option><option value="4">é€±å››</option><option value="5">é€±äº”</option><option value="6">é€±å…­</option><option value="0">é€±æ—¥</option></select>
                </div>
                <button onclick="checkStoreDate()" class="w-full bg-orange-500 text-white py-3 rounded-xl font-bold">ç¢ºèªç‡Ÿæ¥­</button>
                `;
            } else if (level.type === 'calc') {
                html += `<input type="number" id="calc-in" class="w-full border p-3 rounded-lg mb-3 text-center" placeholder="è¼¸å…¥é‡‘é¡"><button onclick="checkStoreCalc(${level.ans})" class="w-full bg-orange-500 text-white py-3 rounded-xl font-bold">æ‰¾éŒ¢</button>`;
            } else if (level.type === 'clock') {
                html += `<button onclick="nextStoreLevel(true)" class="w-full bg-orange-500 text-white py-3 rounded-xl font-bold">ç¾åœ¨å‡ºç™¼</button>`;
            } else if (level.type === 'action') {
                html += `<div class="grid grid-cols-2 gap-2"><button class="py-4 bg-gray-800 text-white rounded">é›»æº</button><button onclick="nextStoreLevel(true)" class="py-4 bg-red-500 text-white rounded">è¼¸å…¥æº</button></div>`;
            } else if (level.type === 'hidden') {
                html += `<div class="space-y-3"><button onclick="nextStoreLevel(false)" class="w-full py-3 border border-orange-200 rounded-xl font-bold">è¨˜å¸³æœ¬å€</button><button onclick="nextStoreLevel(false)" class="w-full py-3 border border-orange-200 rounded-xl font-bold">ç®—ç›¤å€</button><button onclick="nextStoreLevel(true)" class="w-full py-3 border border-orange-200 rounded-xl font-bold">é›¶éŒ¢å€</button></div>`;
            }
            container.innerHTML = html + `</div>`;
        }
        function checkStoreCalc(ans) { const val = document.getElementById('calc-in').value; nextStoreLevel(true); }
        function nextStoreLevel(correct) { storeLevel++; renderStoreLevel(); }
        function renderStoreResult() { document.getElementById('store-game-content').innerHTML = `<div class="store-card text-center animate-fade-in"><h3 class="font-bold text-2xl text-orange-600 mb-2">ç‡Ÿé‹å›é¡§</h3><p class="text-sm text-gray-600 mb-6">æ‚¨çš„åˆ¤æ–·åŠ›å„ªè‰¯ï¼Œä»Šæ—¥å…±ç²å¾— 30 é»æ•¸ï¼</p><button onclick="closeStoreGame();" class="w-full bg-orange-500 text-white py-3 rounded-xl font-bold shadow-lg">æ‰“çƒŠä¼‘æ¯</button></div>`; }

        // ================= MOOD CHAT ENGINE =================
        const moodFlow = [
            { q: "æ—©å®‰ï¼ä»Šå¤©éå¾—é‚„å¥½å—ï¼Ÿ", opts: ["é‚„ä¸éŒ¯", "æ™®é€š", "æœ‰é»ç´¯"] },
            { q: "æœ€è¿‘å¿ƒæƒ…èƒ½é‡å¦‚ä½•å‘¢ï¼Ÿ", opts: ["æœ‰é»ç·Šç¹ƒ", "æ²’ä»€éº¼åŠ›æ°£", "å¿ƒæƒ…ä½ä½çš„", "è »ç©©å®šçš„"] },
            { q: "æ˜¨æ™šç¡å¾—å¥½å—ï¼Ÿ", opts: ["ä¸€è¦ºåˆ°å¤©äº®", "æ™®é€š", "å¾ˆå®¹æ˜“é†’ä¾†"] },
            { q: "ç™½å¤©å°ˆæ³¨åŠ›å¦‚ä½•ï¼Ÿ", opts: ["å¾ˆå°ˆå¿ƒ", "å¶çˆ¾åˆ†å¿ƒ", "å¸¸å¸¸æç¥"] }
        ];
        let moodStep = 0;

        function startMoodChat() {
            moodStep = 0;
            document.getElementById('view-mood-chat').classList.remove('hidden');
            const history = document.getElementById('mood-chat-history');
            history.innerHTML = '';
            renderMoodStep();
        }
        function closeMoodChat() { document.getElementById('view-mood-chat').classList.add('hidden'); }

        function renderMoodStep() {
            const history = document.getElementById('mood-chat-history');
            const controls = document.getElementById('mood-chat-controls');
            if(moodStep >= moodFlow.length) {
                history.insertAdjacentHTML('beforeend', `<div class="flex gap-2 items-end mb-4"><div class="w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center text-pink-500 text-xs font-bold">å°æ¨‚</div><div class="bg-white p-3 rounded-2xl rounded-bl-none shadow-sm text-sm border border-pink-100">æœ¬é€±å¿ƒæƒ…æ‘˜è¦ï¼šçœ‹èµ·ä¾†æ‚¨æœ€è¿‘ç¡çœ å“è³ªç¨å—å½±éŸ¿ï¼Œå»ºè­°ç¡å‰å¯ä»¥è½é»è¼•éŸ³æ¨‚æ”¾é¬†å–”ï¼</div></div>`);
                controls.innerHTML = `<button onclick="closeMoodChat(); alert('å®Œæˆå¿ƒæƒ…ç´€éŒ„ +20 Pts')" class="w-full bg-pink-500 text-white py-2 rounded-full font-bold">å®Œæˆå°è©±</button>`;
                document.getElementById('recent-activity-text').innerText = "å®Œæˆå¿ƒæƒ…æº«åº¦è¨ˆ - æƒ…ç·’ç©©å®š";
                return;
            }
            const step = moodFlow[moodStep];
            setTimeout(() => {
                history.insertAdjacentHTML('beforeend', `<div class="flex gap-2 items-end mb-4 animate-fade-in"><div class="w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center text-pink-500 text-xs font-bold">å°æ¨‚</div><div class="bg-white p-3 rounded-2xl rounded-bl-none shadow-sm text-sm border border-pink-100">${step.q}</div></div>`);
                history.scrollTop = history.scrollHeight;
            }, 300);
            controls.innerHTML = `<div class="flex flex-wrap gap-2 justify-center">${step.opts.map(o => `<button onclick="nextMood('${o}')" class="px-4 py-2 bg-white border border-pink-200 text-pink-600 rounded-full text-xs font-bold hover:bg-pink-50">${o}</button>`).join('')}</div>`;
        }

        function nextMood(ans) {
            const history = document.getElementById('mood-chat-history');
            history.insertAdjacentHTML('beforeend', `<div class="flex justify-end mb-4 animate-slide-up"><div class="bg-pink-500 text-white px-4 py-2 rounded-2xl rounded-br-none shadow-sm text-sm">${ans}</div></div>`);
            moodStep++;
            renderMoodStep();
        }

        function simulateGame(type, scoreBase) { alert(`æ¨¡æ“¬å®Œæˆã€Œ${type}ã€è¨“ç·´ï¼\nå¾—åˆ†ï¼š${scoreBase + Math.floor(Math.random() * 10)}\næ¨‚æ´»é»æ•¸ +20`); }
        function showLeaderboard(type) { document.getElementById('view-leaderboard').classList.remove('hidden'); document.getElementById('lb-game-name').innerText = type + "è¨“ç·´"; document.getElementById('lb-score').innerText = Math.floor(Math.random() * 15 + 80); }
        function closeLeaderboard() { document.getElementById('view-leaderboard').classList.add('hidden'); }

        window.onload = function() { 
            switchView('home');
            renderArticles(); 
        };
    </script>
</body>
</html>